# STMS103F-PWM-INPUT-CAPTURE-EXAMPLE-IN-ASSEMBLY
STMS103F PWM INPUT CAPTURE EXAMPLE IN ASSEMBLY. PC6 is the input channel1 for timer1. UART output on PD5. RM0016 example implemented. input on timer1 channel1 is roted to TI1FP1 and TI1FP2 and triggered by rising edge on chanel1 and on TI1FP1. chanel 2 triggered by falling edge. The rising edge resets the counter to 0 when a rising edge is detected on PC6 due to selection of reset trigger mode in TIM1_SMCR register ,TS=101 TI1FP1 selected as triggered channel and SMS = 100 reset trigger mode. The captured value in CCR2H abd CCR2L is the count from rising edge to the falling edge which is the width of PWM. Multiply the counter value with period of each timer click to get the time in ms . The exaple in RM0016 says that the CCR1H & CCR1L will contain the total period of the cycle but I got 0x0000, may be the trigger reset sets it 0 before the capture hence i removed the CC1 interrupt and relied on CC2 only hich gives the PWM ON time . The code in PWM_capture_hardware gives only PWM , use option bytes AFR0 =1 to enable timer1channel1 as input, tim1_ch1 is aletrnate function in STM8S103F3. The attached file is STVD project and can be programmed by STVP. The code in PWM_capture gives PWM and period but the trigger settings are manually changed inside the ISR. In the first CC1 interrupt the rising value is copied and in the CC2 the falling value of counter is copied. The counter is reset manually writing 0 in the counter registers. The count is synced manually to the falling edge and 3 edges are used for the calculation. the PWM_capture project uses timer1 channel4 PC4 as its input and can be directly programmed without enabling alternate function. outputs period count ,on time count, total period ms and on time ms on PD5 via UART 9600 baud
